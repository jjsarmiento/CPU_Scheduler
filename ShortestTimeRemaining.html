<html>
	<head>
		<style>
            body {
                font-family : Arial;
            }
            td {
                padding : 0.3em;
                text-align : center;
            }
            thead {
                font-weight : bold;
            }
            .gantt_block {
                text-align: center;
                padding: 0.4em;
                height: 5em;
                float: left;
                display: block;
                color: whitesmoke;
                font-weight: bold;
            }
            table {
                border-collapse : collapse;
            }
            .bubble {
                -webkit-box-shadow: 0px 0px 21px 1px rgba(0,0,0,0.84);
                -moz-box-shadow: 0px 0px 21px 1px rgba(0,0,0,0.84);
                box-shadow: 0px 0px 21px 1px rgba(0,0,0,0.84);
            }
		</style>
		<script src="js/jquery-3.1.0.min.js"></script>
		<script>
            var ready_queue = [];
            var cpu_process = null;
            var cpu_bursttime = null;
            var GLOBAL_startTime = null;
            var GLOBAL_endTime = null;
            var GLOBAL_bubbleStart = null;
            var GLOBAL_bubbleEnd = null;
            var my_console = $('#cust_console');
            var my_gantt_chart = $('#gantt_chart');
            var my_colors = [
                '#E74C3C',
                '#8E44AD',
                '#16A085',
                '#D35400'
            ];

			$(document).ready(function(){

                $('input').each(function(){
                    $(this).val(Math.floor(Math.random() * 10) + 1);
                });

				$('#INIT_COMPUTE').click(function(){
					if(checkValues()){
                        for(var i=GET_ARRIVALTIME_LOWEST(); i <= GET_BURSTTIME_SUM(); i++){
                            PROCESS_ARRIVALS(i);

                            if(cpu_process == null){ // no on going process
                                if(ready_queue.length > 0){ // ready queue has process to be done
                                    // check if there is bubble to be put in gantt chart
                                    if(GLOBAL_bubbleStart != null){
                                        $('#gantt_chart').append('<div class="gantt_block bubble" style="background-color: white; width: 10%; border: 1px solid #333333; color: black;">BUBBLE<br/>'+GLOBAL_bubbleStart+' - '+GLOBAL_bubbleEnd+'</div>');
                                        GLOBAL_bubbleStart = null;
                                        GLOBAL_bubbleEnd = null;
                                    }

                                    SORT_READY_QUEUE();
                                    cpu_process = ready_queue[0].split('?')[0];
                                    cpu_bursttime = ready_queue[0].split('?')[1];
                                    GLOBAL_startTime = i;
                                    ready_queue.shift(); // removes process form ready queue
                                    console.log(i+' : INSERT PR TO CPU : '+cpu_process+'/'+cpu_bursttime);
                                }else{
                                    if(GLOBAL_bubbleStart == null){
                                        GLOBAL_bubbleStart = i;
                                    }
                                    GLOBAL_bubbleEnd = i;
                                    //$('#gantt_chart').append('<div class="gantt_block bubble" style="background-color: white; width: 10%; border: 1px solid #333333; color: black;">BUBBLE<br/>'+GLOBAL_startTime+' - '+tmp_at+'</div>');
                                    console.log(i+' : BUBBLE : BUBBLE');
                                }
                            }else{ // on going process
                                if(cpu_bursttime > 0){

                                    cpu_bursttime--;
                                    GLOBAL_endTime = i;
                                    console.log(i+' : DECREMENT : '+cpu_process+'/'+cpu_bursttime);

                                    var og_temp_bt = -1;
                                    var og_temp_pr = -1;

                                    if(ready_queue.length > 0){ // initialize values from ready queue for checking
                                        SORT_READY_QUEUE();
                                        og_temp_pr = ready_queue[0].split('?')[0];
                                        og_temp_bt = ready_queue[0].split('?')[1];
                                    }

                                    console.log(i+' : CHECK Q : '+cpu_process+'/'+cpu_bursttime+' | '+og_temp_pr+'/'+og_temp_bt+' | '+ready_queue);

                                    if(og_temp_bt < cpu_bursttime && og_temp_bt != -1 && og_temp_pr != -1) { // if lowest bt process on rq has lower bt than in the CPU
                                        var bt_of_process = GET_BT_OF_PROCESS(cpu_process);
                                        var curr_width = ((bt_of_process / GET_BURSTTIME_TOTAL()) * 80);
                                        GLOBAL_endTime = i;
                                        console.log(i+' : INSERT GC : P'+cpu_process+' - '+GLOBAL_startTime+'/'+GLOBAL_endTime);
                                        $('#gantt_chart').append('<div class="gantt_block" style="background-color: '+my_colors[(cpu_process-1)]+'; width: '+curr_width+'%;">P'+cpu_process+'<br/>'+GLOBAL_startTime+' - '+GLOBAL_endTime+'</div>');

                                        ready_queue.push(cpu_process+'?'+cpu_bursttime);
//                                        INSET_GANTT_DIVISION(cpu_process);
                                        cpu_bursttime = og_temp_bt;
                                        cpu_process = og_temp_pr;
                                        ready_queue.shift();
                                        SORT_READY_QUEUE();
                                        GLOBAL_startTime = i;
                                        console.log(i+' : CHANGE PROCESS : '+cpu_process+'/'+cpu_bursttime);

                                        cpu_bursttime--;
//                                        GLOBAL_endTime = i;
                                        console.log(i+' : DECREMENT : '+cpu_process+'/'+cpu_bursttime);
                                    }
                                    if(cpu_bursttime == 0){
                                        GLOBAL_endTime = i;
                                        //INSET_GANTT_DIVISION(cpu_process)
                                        var bt_of_process = GET_BT_OF_PROCESS(cpu_process);
                                        var curr_width = ((bt_of_process / GET_BURSTTIME_TOTAL()) * 80);
                                        console.log(i+' : INSERT GC : P'+cpu_process+' - '+GLOBAL_startTime+'/'+GLOBAL_endTime);
                                        $('#gantt_chart').append('<div class="gantt_block" style="background-color: '+my_colors[(cpu_process-1)]+'; width: '+curr_width+'%;">P'+cpu_process+'<br/>'+GLOBAL_startTime+' - '+GLOBAL_endTime+'</div>');

                                        if(ready_queue.length > 0){ // ready queue has process to be done
                                            SORT_READY_QUEUE();
                                            cpu_process = ready_queue[0].split('?')[0];
                                            cpu_bursttime = ready_queue[0].split('?')[1];
                                            GLOBAL_startTime = i;
                                            ready_queue.shift(); // removes process form ready queue
                                            console.log(i+' : INSERT PR TO CPU : '+cpu_process+'/'+cpu_bursttime);
                                        }else{ // bubble time
                                            console.log(i+' : BUBBLE : BUBBLE');
                                        }

                                        //                                    cpu_bursttime = null;
                                        //                                    cpu_process = null;
                                        GLOBAL_startTime = i;
                                        console.log(i+' : PR DONE / INSERT NEW PR : '+cpu_process+'/'+cpu_bursttime);
                                    }
                                }
                            }
                        }
					}
				});
				$('#methods').change(function(){
					location.href = $(this).val();
				})
			});

            function INSET_GANTT_DIVISION(process){
                var bt_of_process = GET_BT_OF_PROCESS(process);
                var curr_width = ((bt_of_process / GET_BURSTTIME_TOTAL()) * 80);
                $('#gantt_chart').append('<div class="gantt_block" style="background-color: '+my_colors[(cpu_process-1)]+'; width: '+curr_width+'%;">P'+cpu_process+'<br/>'+GLOBAL_startTime+' - '+GLOBAL_endTime+'</div>');
            }

            function PROCESS_ARRIVALS(time){
                $('.arrival_time').each(function(index){ // check for arrivals
                    var curr_arrival_time = Math.round(parseFloat($(this).val()));
                    if(curr_arrival_time == parseFloat(time)){
                        var process_number = index+1;
                        var curr_bursttime = parseFloat($('[data-process="'+(process_number)+'"][class="burst_time"]').val());
                        ready_queue.push(process_number+'?'+curr_bursttime);
                        console.log(time+' : PROCESS ARRIVED : '+process_number+'/'+curr_bursttime+' | '+ready_queue);
                        SORT_READY_QUEUE();
                    }
                });
            }

            function SORT_READY_QUEUE(){
                ready_queue.sort(function(a,b){ // sort queue by lowest bt first
                    return a.split('?')[1] - b.split('?')[1]
                });
            }

            function GET_BT_OF_PROCESS(cpu){
                return parseFloat(Math.round($('[data-process="'+(cpu)+'"][class="burst_time"]').val()));
            }

            function GET_BURSTTIME_SUM(){
                var total = 0.0;
                $('.burst_time').each(function(index){
                    total += parseFloat($(this).val());
                });

                return (total + GET_ARRIVALTIME_LOWEST());
            }

            function GET_BURSTTIME_TOTAL(){
                var total = 0.0;
                $('.burst_time').each(function(index){
                    total += parseFloat($(this).val());
                });

                // adjust bt by the lowest bt in case lowest BT is not equal to zero
                if(GET_BURSTTIME_LOWEST() != 0){
                    total += GET_BURSTTIME_LOWEST();
                }

                if(GET_ARRIVALTIME_HIGHEST() > total){
                    total = GET_ARRIVALTIME_HIGHEST();
                }

                return parseFloat(total);
            }

            function GET_ARRIVALTIME_HIGHEST(){
                var highest = 0;
                $('.arrival_time').each(function(){
                    if(highest == 0){
                        highest = parseFloat($(this).val());
                    }
                    if(parseFloat($(this).val()) > highest){
                        highest = parseFloat($(this).val());
                    }
                });
                return parseFloat(highest);
            }

            function GET_ARRIVALTIME_LOWEST(){
                var lowest = GET_ARRIVALTIME_HIGHEST();
                $('.arrival_time').each(function(){
                    if(parseFloat($(this).val()) < lowest){
                        lowest = parseFloat($(this).val());
                    }
                });

                return lowest;
            }

            function GET_BURSTTIME_LOWEST(){
                var x = GET_BURSTTIME_HIGHEST();
                $('.burst_time').each(function(index){
                    var bt = parseFloat($(this).val());
                    if(bt < x){
                        x = bt;
                    }
                });

                return parseFloat(x);
            }

            function GET_BURSTTIME_HIGHEST(){
                var x = 0;
                $('.burst_time').each(function(index){
                    var bt = parseFloat($(this).val());
                    if(bt > 0){
                        x = bt;
                    }
                });

                return parseFloat(x);
            }

			function checkValues(){
				var flag = true;
				$('#cust_console').empty();
				$('.arrival_time').each(function(index){
					// check if arrival_time is filled out
					if($(this).val() == '' || !$.isNumeric($(this).val())){
						$('#cust_console').append('Please input a number for Arrival Time for Process P'+(index+1)+'<br/>');
						flag = false;
					}
				})
				$('.burst_time').each(function(index){
					// check if burst_time is filled out
					if($(this).val() == '' || !$.isNumeric($(this).val())){
						$('#cust_console').append('Please input a number for Burst Time for Process P'+(index+1)+'<br/>');
						flag = false;
					}
				})
				$('.priority').each(function(index){
					// check if burst_time is filled out
					if($(this).val() == '' || !$.isNumeric($(this).val())){
						$('#cust_console').append('Please input a number for Priority for Process P'+(index+1)+'<br/>');
						flag = false;
					}
				})

				return flag;
			}
		</script>
	</head>
	<body>
		Scheduling Methods
		<select id="methods">
			<option value="">SELECT A METHOD</option>
			<option value="index.html">First Come, First Serve (FCFS)</option>
			<option value="ShortestJobFirst.html">Shortest Job First</option>
			<option value="ShortestTimeRemaining.html">Shortest Time Remaining</option>
			<option value="PriorityNonPreemptive.html">Priority Non-Preemptive</option>
			<option value="PriorityPreemptive.html">Priority Preemptive</option>
			<option value="RoundRobin.html">Round Robin</option>
		</select>
		<br/>
		<br/>
		<h1>Shortest Time Remaining</h1>
        <table border="1">
            <thead>
            <tr>
                <td>Process Name</td>
                <td>Arrival Time</td>
                <td>Burst Time</td>
                <td>Turn-Around Time</td>
                <td>Waiting Time</td>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>P1</td>
                <td><input data-process="1" type="text" class="arrival_time" /></td>
                <td><input data-process="1" type="text" class="burst_time" /></td>
                <td><span class="TAT" id="P1_TAT"></span></td>
                <td><span class="WT" id="P1_WT"></span></td>
            </tr>
            <tr>
                <td>P2</td>
                <td><input data-process="2" type="text" class="arrival_time" /></td>
                <td><input data-process="2" type="text" class="burst_time" /></td>
                <td><span class="TAT" id="P2_TAT"></span></td>
                <td><span class="WT" id="P2_WT"></span></td>
            </tr>
            <tr>
                <td>P3</td>
                <td><input data-process="3" type="text" class="arrival_time" /></td>
                <td><input data-process="3" type="text" class="burst_time" /></td>
                <td><span class="TAT" id="P3_TAT"></span></td>
                <td><span class="WT" id="P3_WT"></span></td>
            </tr>
            <tr>
                <td>P4</td>
                <td><input data-process="4" type="text" class="arrival_time" /></td>
                <td><input data-process="4" type="text" class="burst_time" /></td>
                <td><span class="TAT" id="P4_TAT"></span></td>
                <td><span class="WT" id="P4_WT"></span></td>
            </tr>
            <tr>
                <td colspan="3">Average</td>
                <td><span id="AVG_TAT"></span></td>
                <td><span id="AVG_WT"></span></td>
            </tr>
            </tbody>
        </table>
        <br/>
        <div style="width: 80%">
            <div id="gantt_chart">
            </div>
        </div>
        <div style="clear: both;"></div>
        <p id="cust_console" style="color:red;"></p>
        <button id="INIT_COMPUTE">Compute</button>
	</body>
</html>